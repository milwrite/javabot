# Agent regression follow-ups

- [ ] Gate tool usage and pipeline auto-runs: dashboard run at 9:42:53 PM auto-classified a creative ask into the builder, generated `src/case-brief-peanut-shells.html` (20k chars) with plan/test/scribe without confirming intent; simple “link the tv infomercial and letter to cen” in `logs/session-logs/bot-session-2025-12-18_14-23-10-raw.log` triggered multiple tool iterations (1–3) despite being a lightweight link request.
- [ ] OpenRouter protocol compliance: repeated 402 errors in `logs/session-logs/bot-session-2025-12-17_04-16-23-raw.log` requested 10k tokens against credit limits and retried the same payload; prior config also mixed `effort` and `max_tokens` (see `issues/2025-12-20-openrouter-reasoning-config.md`), so ensure requests follow docs, downgrade token budgets, and stop retrying bad requests.
- [ ] Trim API/tool call volume: current mention handler runs up to 6 attempts and batches multiple tool calls per iteration even when the classifier returns CONVERSATION; reduce to a single clarified turn before tool use and cap retries.
- [ ] Fix memory/context handling: user corrections (“i asked for only two of those”, “to cen”) in `logs/session-logs/bot-session-2025-12-18_14-23-10-raw.log` were not incorporated, suggesting past messages fell out of the context window; add context stitching and tests.
- [ ] Response/style alignment: the generated paratext page ignores site conventions and is verbose; enforce house style, shorter replies, and limit autogenerated HTML size before shipping.
- [ ] Telemetry and guardrails: mark sessions as degraded when user-visible errors occur (e.g., repeated OpenRouter 402s or overbuilt pages) instead of “SUCCESS”, and surface actionable warnings in the dashboard.
