<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pleasantville Crossword - Bot Sportello</title>
    <link rel="stylesheet" href="../page-theme.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: #0a0a0a;
            color: #7ec8e3;
            font-family: 'Courier Prime', monospace;
            margin: 0;
            padding: 80px 20px 20px 20px;
            overflow-x: auto;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            body {
                padding: 60px 5px 20px 5px;
            }
        }

        .game-container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        h1 {
            color: #00ffff;
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #00ffff;
        }

        .subtitle {
            color: #7ec8e3;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .crossword-grid {
            display: inline-grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: #1a1a1a;
            padding: 10px;
            border: 2px solid #7ec8e3;
            margin: 20px auto;
            max-width: 100%;
        }

        @media (max-width: 768px) {
            .crossword-grid {
                gap: 1px;
                padding: 5px;
            }
        }

        .cell {
            aspect-ratio: 1;
            background: #0a0a0a;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #00ffff;
            cursor: pointer;
            position: relative;
            min-width: 40px;
            transition: all 0.2s;
        }

        @media (max-width: 480px) {
            .cell {
                font-size: 1.2em;
                min-width: 35px;
            }
        }

        .cell.black {
            background: #1a1a1a;
            cursor: default;
        }

        .cell.active {
            background: #7ec8e3;
            color: #0a0a0a;
            box-shadow: 0 0 10px #7ec8e3;
        }

        .cell.correct {
            background: #00ff00;
            color: #0a0a0a;
        }

        .cell.incorrect {
            background: #ff0000;
            color: #fff;
        }

        .cell-number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 0.4em;
            color: #7ec8e3;
        }

        .clues-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
            text-align: left;
        }

        @media (max-width: 768px) {
            .clues-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .clue-section h3 {
            color: #ff0000;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .clue {
            margin: 8px 0;
            padding: 8px;
            background: #1a1a1a;
            border-left: 3px solid #333;
            cursor: pointer;
            transition: all 0.2s;
        }

        .clue:hover, .clue.active {
            border-left-color: #7ec8e3;
            background: #0f0f0f;
        }

        .clue-number {
            color: #ff0000;
            font-weight: bold;
        }

        .mobile-controls-label {
            color: #7ec8e3;
            margin: 15px 0 10px 0;
            font-size: 0.9em;
        }

        .mobile-controls {
            display: none;
            grid-template-columns: repeat(10, 1fr);
            gap: 4px;
            max-width: 100%;
            margin: 15px auto;
            padding: 0 10px;
        }

        @media (max-width: 768px) {
            .mobile-controls {
                display: grid;
            }
        }

        .key-btn {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            background: #1a1a1a;
            color: #7ec8e3;
            border: 1px solid #7ec8e3;
            padding: 12px 4px;
            font-family: 'Courier Prime', monospace;
            font-size: 16px;
            cursor: pointer;
            min-height: 44px;
            transition: all 0.2s;
        }

        .key-btn:active {
            background: #7ec8e3;
            color: #0a0a0a;
            transform: scale(0.95);
        }

        .key-btn.wide {
            grid-column: span 2;
        }

        .controls {
            margin: 20px 0;
        }

        .btn {
            background: #ff0000;
            color: #fff;
            border: 2px solid #ff0000;
            padding: 12px 24px;
            font-family: 'Courier Prime', monospace;
            font-size: 1em;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s;
            min-height: 44px;
            min-width: 120px;
        }

        .btn:hover {
            background: #0a0a0a;
            color: #ff0000;
            box-shadow: 0 0 10px #ff0000;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .status {
            margin: 15px 0;
            font-size: 1.1em;
            min-height: 30px;
        }

        .status.success {
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }

        .status.error {
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
        }

        .instructions {
            background: #1a1a1a;
            border: 1px solid #7ec8e3;
            padding: 15px;
            margin: 20px 0;
            text-align: left;
        }

        .instructions h3 {
            color: #00ffff;
            margin-top: 0;
        }

        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-link">‚Üê BACK TO TERMINAL</a>

    <div class="game-container">
        <h1>PLEASANTVILLE CROSSWORD</h1>
        <p class="subtitle">A noir puzzle from the streets</p>

        <div class="instructions">
            <h3>HOW TO PLAY:</h3>
            <ul>
                <li>Click/tap a cell to select it</li>
                <li>Type letters on your keyboard (desktop) or use on-screen keyboard (mobile)</li>
                <li>Click clues to jump to that word</li>
                <li>Press BACKSPACE/DELETE to clear cells</li>
                <li>Click CHECK to verify your answers</li>
            </ul>
        </div>

        <div id="crosswordGrid" class="crossword-grid"></div>

        <div class="mobile-controls-label">Tap letters to fill crossword ‚Üí</div>
        <div class="mobile-controls" id="mobileControls">
            <button class="key-btn" data-key="Q">Q</button>
            <button class="key-btn" data-key="W">W</button>
            <button class="key-btn" data-key="E">E</button>
            <button class="key-btn" data-key="R">R</button>
            <button class="key-btn" data-key="T">T</button>
            <button class="key-btn" data-key="Y">Y</button>
            <button class="key-btn" data-key="U">U</button>
            <button class="key-btn" data-key="I">I</button>
            <button class="key-btn" data-key="O">O</button>
            <button class="key-btn" data-key="P">P</button>
            <button class="key-btn" data-key="A">A</button>
            <button class="key-btn" data-key="S">S</button>
            <button class="key-btn" data-key="D">D</button>
            <button class="key-btn" data-key="F">F</button>
            <button class="key-btn" data-key="G">G</button>
            <button class="key-btn" data-key="H">H</button>
            <button class="key-btn" data-key="J">J</button>
            <button class="key-btn" data-key="K">K</button>
            <button class="key-btn" data-key="L">L</button>
            <button class="key-btn wide" data-key="BACK">‚Üê</button>
            <button class="key-btn" data-key="Z">Z</button>
            <button class="key-btn" data-key="X">X</button>
            <button class="key-btn" data-key="C">C</button>
            <button class="key-btn" data-key="V">V</button>
            <button class="key-btn" data-key="B">B</button>
            <button class="key-btn" data-key="N">N</button>
            <button class="key-btn" data-key="M">M</button>
            <button class="key-btn wide" data-key="SPACE">SPACE</button>
        </div>

        <div class="controls">
            <button class="btn" id="checkBtn">CHECK ANSWERS</button>
            <button class="btn" id="clearBtn">CLEAR ALL</button>
        </div>

        <div class="status" id="status"></div>

        <div class="clues-container">
            <div class="clue-section">
                <h3>ACROSS</h3>
                <div id="acrossClues"></div>
            </div>
            <div class="clue-section">
                <h3>DOWN</h3>
                <div id="downClues"></div>
            </div>
        </div>
    </div>

    <script>
        const GRID_SIZE = 7;
        
        const puzzleData = {
            grid: [
                ['D', 'E', 'T', 'E', 'C', 'T', 'I'],
                ['A', null, 'R', null, 'A', null, 'N'],
                ['M', 'Y', 'S', 'T', 'E', 'R', 'Y'],
                ['E', null, 'T', null, null, null, 'K'],
                ['S', 'H', 'A', 'D', 'O', 'W', null],
                ['null', null, 'K', null, null, null, 'C'],
                ['C', 'L', 'U', 'E', 'S', null, 'E']
            ],
            clues: {
                across: [
                    { number: 1, clue: "Private eye's job (7)", answer: "DETECTI", row: 0, col: 0, length: 7 },
                    { number: 3, clue: "Unsolved case (7)", answer: "MYSTERY", row: 2, col: 0, length: 7 },
                    { number: 5, clue: "Dark figure (6)", answer: "SHADOW", row: 4, col: 0, length: 6 },
                    { number: 7, clue: "What detectives follow (5)", answer: "CLUES", row: 6, col: 0, length: 5 }
                ],
                down: [
                    { number: 1, clue: "Femme fatale (5)", answer: "DAMES", row: 0, col: 0, length: 5 },
                    { number: 2, clue: "Crime scene evidence (5)", answer: "TRACE", row: 0, col: 2, length: 5 },
                    { number: 4, clue: "Case file (5)", answer: "STACK", row: 2, col: 2, length: 5 },
                    { number: 6, clue: "Noir atmosphere (5)", answer: "INKY", row: 0, col: 6, length: 4 },
                    { number: 8, clue: "Cold case (3)", answer: "ICE", row: 4, col: 5, length: 3 }
                ]
            }
        };

        let currentCell = null;
        let userGrid = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(''));

        function initGrid() {
            const gridContainer = document.getElementById('crosswordGrid');
            gridContainer.innerHTML = '';

            const numberMap = {};
            let clueNumber = 1;

            puzzleData.clues.across.forEach(clue => {
                numberMap[`${clue.row}-${clue.col}`] = clue.number;
            });
            puzzleData.clues.down.forEach(clue => {
                if (!numberMap[`${clue.row}-${clue.col}`]) {
                    numberMap[`${clue.row}-${clue.col}`] = clue.number;
                }
            });

            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;

                    if (puzzleData.grid[row][col] === null) {
                        cell.classList.add('black');
                    } else {
                        const cellKey = `${row}-${col}`;
                        if (numberMap[cellKey]) {
                            const numSpan = document.createElement('span');
                            numSpan.className = 'cell-number';
                            numSpan.textContent = numberMap[cellKey];
                            cell.appendChild(numSpan);
                        }

                        cell.addEventListener('click', () => selectCell(row, col));
                    }

                    gridContainer.appendChild(cell);
                }
            }
        }

        function selectCell(row, col) {
            if (puzzleData.grid[row][col] === null) return;

            document.querySelectorAll('.cell.active').forEach(c => c.classList.remove('active'));
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('active');
            
            currentCell = { row, col };
        }

        function inputLetter(letter) {
            if (!currentCell) return;

            const { row, col } = currentCell;
            
            if (puzzleData.grid[row][col] === null) return;

            userGrid[row][col] = letter.toUpperCase();
            updateDisplay();

            moveToNextCell();
        }

        function deleteLetter() {
            if (!currentCell) return;

            const { row, col } = currentCell;
            userGrid[row][col] = '';
            updateDisplay();
        }

        function moveToNextCell() {
            if (!currentCell) return;

            let { row, col } = currentCell;
            
            do {
                col++;
                if (col >= GRID_SIZE) {
                    col = 0;
                    row++;
                    if (row >= GRID_SIZE) {
                        row = 0;
                    }
                }
            } while (puzzleData.grid[row][col] === null && !(row === currentCell.row && col === currentCell.col));

            if (puzzleData.grid[row][col] !== null) {
                selectCell(row, col);
            }
        }

        function updateDisplay() {
            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                    if (cell && !cell.classList.contains('black')) {
                        const numberSpan = cell.querySelector('.cell-number');
                        cell.textContent = userGrid[row][col];
                        if (numberSpan) {
                            cell.appendChild(numberSpan);
                        }
                    }
                }
            }
        }

        function checkAnswers() {
            let correct = 0;
            let total = 0;

            for (let row = 0; row < GRID_SIZE; row++) {
                for (let col = 0; col < GRID_SIZE; col++) {
                    const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                    if (puzzleData.grid[row][col] !== null) {
                        total++;
                        cell.classList.remove('correct', 'incorrect');
                        
                        if (userGrid[row][col] === puzzleData.grid[row][col]) {
                            cell.classList.add('correct');
                            correct++;
                        } else if (userGrid[row][col]) {
                            cell.classList.add('incorrect');
                        }
                    }
                }
            }

            const status = document.getElementById('status');
            if (correct === total) {
                status.textContent = 'üéâ CASE SOLVED! Perfect score!';
                status.className = 'status success';
            } else {
                status.textContent = `${correct} / ${total} correct. Keep investigating...`;
                status.className = 'status';
            }

            setTimeout(() => {
                document.querySelectorAll('.cell').forEach(cell => {
                    cell.classList.remove('correct', 'incorrect');
                });
            }, 2000);
        }

        function clearAll() {
            userGrid = Array(GRID_SIZE).fill(null).map(() => Array(GRID_SIZE).fill(''));
            updateDisplay();
            document.getElementById('status').textContent = '';
            document.getElementById('status').className = 'status';
        }

        function initClues() {
            const acrossContainer = document.getElementById('acrossClues');
            const downContainer = document.getElementById('downClues');

            puzzleData.clues.across.forEach(clue => {
                const clueDiv = document.createElement('div');
                clueDiv.className = 'clue';
                clueDiv.innerHTML = `<span class="clue-number">${clue.number}.</span> ${clue.clue}`;
                clueDiv.addEventListener('click', () => selectCell(clue.row, clue.col));
                acrossContainer.appendChild(clueDiv);
            });

            puzzleData.clues.down.forEach(clue => {
                const clueDiv = document.createElement('div');
                clueDiv.className = 'clue';
                clueDiv.innerHTML = `<span class="clue-number">${clue.number}.</span> ${clue.clue}`;
                clueDiv.addEventListener('click', () => selectCell(clue.row, clue.col));
                downContainer.appendChild(clueDiv);
            });
        }

        document.addEventListener('keydown', (e) => {
            if (e.key.length === 1 && e.key.match(/[a-z]/i)) {
                inputLetter(e.key);
            } else if (e.key === 'Backspace' || e.key === 'Delete') {
                e.preventDefault();
                deleteLetter();
            }
        });

        document.querySelectorAll('.key-btn').forEach(btn => {
            const handleKeyPress = () => {
                const key = btn.dataset.key;
                if (key === 'BACK') {
                    deleteLetter();
                } else if (key === 'SPACE') {
                    moveToNextCell();
                } else {
                    inputLetter(key);
                }
            };

            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                handleKeyPress();
            }, { passive: false });

            btn.addEventListener('click', handleKeyPress);
        });

        document.getElementById('checkBtn').addEventListener('click', checkAnswers);
        document.getElementById('clearBtn').addEventListener('click', clearAll);

        initGrid();
        initClues();
        selectCell(0, 0);
    </script>
</body>
</html>