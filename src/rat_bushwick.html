<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ RAT_BUSHWICK: A Rodent's Guide to Dining ğŸ€</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', monospace;
            background: #0a0a0a;
            color: #00ff9f;
            overflow-x: hidden;
            min-height: 100vh;
            text-shadow: 0 0 8px rgba(0, 255, 159, 0.3);
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;;
            pointer-events: none;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            z-index: 9998;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 3px solid #00ff9f;
            box-shadow: 0 0 20px rgba(0, 255, 159, 0.4);
            animation: glitch 3s infinite;
        }

        @keyframes glitch {
            0%, 100% { text-shadow: 0 0 10px rgba(0, 255, 159, 0.5); }
            50% { text-shadow: 0 0 20px rgba(255, 85, 255, 0.5), 0 0 10px rgba(0, 255, 159, 0.3); }
        }

        h1 {
            font-family: 'Courier Prime', monospace;
            font-size: 2.5em;
            margin-bottom: 10px;
            letter-spacing: 2px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2em;
            color: #ff55ff;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 49%, 100% { opacity: 1; }
            50%, 99% { opacity: 0.3; }
        }

        .rat-intro {
            text-align: center;
            margin: 30px 0;
            font-size: 1.5em;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .menu-item {
            background: #1a1a1a;
            border: 2px solid #00ff9f;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 255, 159, 0.3);
        }

        .menu-item:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 255, 159, 0.7);
            border-color: #ff55ff;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 0, 127, 0.3), transparent);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .menu-item h3 {
            font-family: 'Courier Prime', monospace;
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #ff55ff;
            position: relative;
            z-index: 1;
        }

        .menu-item p {
            font-size: 0.9em;
            line-height: 1.6;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .ascii-art {
            background: #000;
            border: 1px solid #7ec8e3;
            padding: 10px;
            margin: 15px 0;
            font-size: 0.7em;
            overflow-x: auto;
            white-space: pre;
            color: #7ec8e3;
            line-height: 1.2;
        }

        .difficulty {
            display: inline-block;
            background: #ff006e;
            color: #000;
            padding: 5px 10px;
            font-weight: bold;
            margin-top: 10px;
            position: relative;
            z-index: 1;
        }

        .btn {
            background: #ff006e;
            color: #000;
            border: 2px solid #7ec8e3;
            padding: 10px 20px;
            font-family: 'Courier Prime', monospace;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
            margin-top: 10px;
        }

        .btn:hover {
            background: #7ec8e3;
            box-shadow: 0 0 20px rgba(126, 200, 227, 0.8);
            transform: scale(1.1);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            margin: 5% auto;
            padding: 30px;
            border: 3px solid #7ec8e3;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 0 40px rgba(126, 200, 227, 0.5);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #ff006e;
            float: right;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close:hover {
            color: #7ec8e3;
            text-shadow: 0 0 10px rgba(126, 200, 227, 0.8);
        }

        .modal h2 {
            font-family: 'Courier Prime', monospace;
            color: #ff006e;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .modal-ascii {
            background: #000;
            border: 1px solid #7ec8e3;
            padding: 15px;
            margin: 20px 0;
            font-size: 0.65em;
            overflow-x: auto;
            white-space: pre;
            color: #7ec8e3;
            line-height: 1.1;
        }

        .achievement {
            background: linear-gradient(135deg, #ff006e, #ffbe0b);
            color: #000;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #7ec8e3;
            font-weight: bold;
            animation: pulse 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .stat-box {
            background: #0f3460;
            border: 2px solid #7ec8e3;
            padding: 15px;
            text-align: center;
            box-shadow: 0 0 10px rgba(126, 200, 227, 0.2);
        }

        .stat-box .label {
            color: #ff006e;
            font-size: 0.8em;
            margin-bottom: 10px;
        }

        .stat-box .value {
            font-size: 1.8em;
            color: #7ec8e3;
        }

        .rat-pixel {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #ff006e;
            margin: 0 2px;
            animation: hop 0.5s ease-in-out infinite;
        }

        @keyframes hop {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .mini-game {
            background: #000;
            border: 3px solid #7ec8e3;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .game-canvas {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background: #1a1a2e;
            border: 2px solid #7ec8e3;
            position: relative;
            overflow: hidden;
            margin: 15px 0;
        }

        .pizza-slice {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #ff9500;
            border: 1px solid #ffb700;
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
        }

        .rat-player {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff006e;
            border-radius: 50%;
        }

        .rat-player::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 5px;
            background: #ff006e;
            right: -8px;
            top: 5px;
            border-radius: 50%;
        }

        .rat-player::before {
            content: '';
            position: absolute;
            width: 3px;
            height: 3px;
            background: #000;
            top: 8px;
            left: 8px;
            border-radius: 50%;
        }

        .leaderboard {
            background: #0f3460;
            border: 2px solid #7ec8e3;
            padding: 20px;
            margin: 30px 0;
        }

        .leaderboard h3 {
            color: #ff006e;
            font-family: 'Courier Prime', monospace;
            margin-bottom: 15px;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(126, 200, 227, 0.2);
            align-items: center;
        }

        .leaderboard-entry:last-child {
            border-bottom: none;
        }

        .rank {
            color: #ff006e;
            font-weight: bold;
            min-width: 40px;
        }

        .score {
            color: #ffbe0b;
            font-weight: bold;
        }

        .footer {
            text-align: center;
            padding: 40px 20px;
            border-top: 2px solid #7ec8e3;
            margin-top: 60px;
            font-size: 0.9em;
        }

        .warning {
            background: #ff006e;
            color: #000;
            padding: 15px;
            margin: 20px 0;
            border: 2px solid #ffbe0b;
            font-weight: bold;
            animation: blink 0.5s infinite;
        }

        .mobile-game-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            max-width: 220px;
            margin: 20px auto 0;
        }

        .control-row {
            display: contents;
        }

        .game-control-btn {
            min-width: 64px;
            min-height: 64px;
            font-size: 28px;
            background: rgba(0, 255, 159, 0.3);
            color: #00ff9f;
            border: 3px solid #00ff9f;
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            transition: all 0.1s;
            font-weight: bold;
        }

        .game-control-btn:active {
            background: #00ff9f;
            color: #000;
            transform: scale(0.95);
        }

        .game-control-btn[data-dir="up"] {
            grid-column: 2;
            grid-row: 1;
        }

        .game-control-btn[data-dir="left"] {
            grid-column: 1;
            grid-row: 2;
        }

        .game-control-btn[data-dir="down"] {
            grid-column: 2;
            grid-row: 2;
        }

        .game-control-btn[data-dir="right"] {
            grid-column: 3;
            grid-row: 2;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.5em;
            }
            .menu-grid {
                grid-template-columns: 1fr;
            }
            .modal-content {
                width: 95%;
                margin: 20% auto;
            }
            .mobile-game-controls {
                display: block;
            }
            .game-canvas {
                max-width: 95vw;
                height: 250px;
            }
        }
    </style>

</head>
<body>
    <a href="../index.html" style="position:fixed;top:20px;left:20px;z-index:9999;text-decoration:none;background:rgba(255,0,0,0.9);color:#7ec8e3;padding:12px 24px;border:2px solid #7ec8e3;box-shadow:0 0 20px rgba(0,255,65,0.5);font-family:'VT323',monospace;font-size:1.2em;">HOME</a>
    
    <div class="scanlines"></div>

    <header>
        <h1>ğŸ€ RAT_BUSHWICK ğŸ€</h1>
        <p class="subtitle">A RODENT'S GUIDE TO FINE DINING</p>
        <div class="rat-intro">
            <span class="rat-pixel"></span>
            <span class="rat-pixel"></span>
            <span class="rat-pixel"></span>
        </div>
    </header>

    <div class="container">
        <div class="stats">
            <div class="stat-box">
                <div class="label">HUNGER LEVEL</div>
                <div class="value" id="hunger">100%</div>
            </div>
            <div class="stat-box">
                <div class="label">CHEESE COLLECTED</div>
                <div class="value" id="cheese">0</div>
            </div>
            <div class="stat-box">
                <div class="label">PIZZA SLICES</div>
                <div class="value" id="pizza">0</div>
            </div>
            <div class="stat-box">
                <div class="label">DUMPSTER DIVES</div>
                <div class="value" id="dives">0</div>
            </div>
        </div>

        <div class="warning">
            âš ï¸ WARNING: HUMAN DETECTION IMMINENT âš ï¸<br>
            STAY ALERT. STAY HUNGRY. STAY RAT.
        </div>

        <!-- Mini Game Section - FEATURED -->
        <div class="mini-game" style="margin-bottom: 40px;">
            <h2 style="font-family: 'Courier Prime', monospace; color: #ff006e; margin-bottom: 20px; font-size: 2em;">ğŸ® PIZZA COLLECTOR ğŸ®</h2>
            <div class="game-canvas" id="gameCanvas" style="max-width: 500px; height: 400px;"></div>

            <!-- Mobile Controls -->
            <div class="mobile-game-controls" id="mobileGameControls">
                <div class="control-row">
                    <button class="game-control-btn" data-dir="up">â†‘</button>
                </div>
                <div class="control-row">
                    <button class="game-control-btn" data-dir="left">â†</button>
                    <button class="game-control-btn" data-dir="down">â†“</button>
                    <button class="game-control-btn" data-dir="right">â†’</button>
                </div>
                <button class="game-control-btn" id="hideBtn" style="grid-column: 1 / -1; margin-top: 8px; background: rgba(255, 85, 255, 0.3); border-color: #ff55ff; color: #ff55ff;">ğŸ«£ HIDE</button>
            </div>

            <div class="game-stats" style="display: flex; gap: 20px; justify-content: center; margin: 15px 0; font-size: 1.2em;">
                <span style="color: #ffbe0b;">Score: <span id="gameScore">0</span></span>
                <span style="color: #ff006e;">Lives: <span id="gameLives">3</span></span>
                <span style="color: #7ec8e3;">Level: <span id="gameLevel">1</span></span>
            </div>

            <button class="btn" onclick="startGame()" style="font-size: 0.9em; padding: 10px 20px;">START GAME</button>

            <p style="margin-top: 15px; font-size: 1.1em; color: #00ff9f;">Collect ğŸ• pizza! Avoid ğŸ± cats! Grab ğŸ§€ cheese for speed! Press SPACE or tap HIDE to escape!</p>
        </div>

        <h2 style="font-family: 'Courier Prime', monospace; color: #ff006e; text-align: center; margin: 40px 0 30px; font-size: 1.8em; border-top: 2px solid #7ec8e3; padding-top: 30px;">ğŸ§© RAT BRAIN TEASERS ğŸ§©</h2>

        <div class="menu-grid">
            <!-- Cheese Maze Puzzle -->
            <div class="menu-item">
                <h3>ğŸ§€ CHEESE MAZE</h3>
                <p>Navigate the ASCII maze to reach the legendary cheese wheel!</p>
                <div class="ascii-art">
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆ ğŸ€    â–ˆ
â–ˆ â–ˆâ–ˆâ–ˆ â–ˆ â–ˆ
â–ˆ   â–ˆ â–ˆ â–ˆ
â–ˆ â–ˆ   â–ˆ â–ˆ
â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆ
â–ˆ     ğŸ§€â–ˆ
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</div>
                <div class="difficulty">DIFFICULTY: EASY</div>
                <button class="btn" onclick="openActivity('maze')">SOLVE PUZZLE</button>
            </div>

            <!-- Rat Trivia -->
            <div class="menu-item">
                <h3>ğŸ§  RAT TRIVIA</h3>
                <p>Test your knowledge of Bushwick rat culture and survival tactics!</p>
                <div class="ascii-art">
  /\_/\
 ( ?.? )
  > ^ <
 /|   |\
(_|   |_)
 Q: WHAT?</div>
                <div class="difficulty">DIFFICULTY: MEDIUM</div>
                <button class="btn" onclick="openActivity('trivia')">START QUIZ</button>
            </div>

            <!-- Pizza Math -->
            <div class="menu-item">
                <h3>ğŸ• PIZZA MATH</h3>
                <p>Calculate optimal pizza slice ratios for the rat colony!</p>
                <div class="ascii-art">
   8 rats
   3 slices
   = ???

  SOLVE TO
  SURVIVE</div>
                <div class="difficulty">DIFFICULTY: HARD</div>
                <button class="btn" onclick="openActivity('math')">CALCULATE</button>
            </div>

            <!-- Word Scramble -->
            <div class="menu-item">
                <h3>ğŸ“ RAT SCRAMBLE</h3>
                <p>Unscramble rat-related words to unlock secret knowledge!</p>
                <div class="ascii-art">
   ~~~
  (o o)
   \ - /
    | |

ZZEIP = ?
EHSECE = ?</div>
                <div class="difficulty">DIFFICULTY: EASY</div>
                <button class="btn" onclick="openActivity('scramble')">UNSCRAMBLE</button>
            </div>

            <!-- Logic Puzzle -->
            <div class="menu-item">
                <h3>ğŸ” RAT LOGIC</h3>
                <p>Deduce which rat stole the pizza using clues and deduction!</p>
                <div class="ascii-art">
  â•­â”€ â”€â•®
  â”‚ ğŸ€ â”‚ Suspect A
  â”‚ ğŸ€ â”‚ Suspect B
  â”‚ ğŸ€ â”‚ Suspect C
  â•°â”€ â”€â•¯
  WHO DID IT?</div>
                <div class="difficulty">DIFFICULTY: HARD</div>
                <button class="btn" onclick="openActivity('logic')">INVESTIGATE</button>
            </div>

            <!-- Pattern Recognition -->
            <div class="menu-item">
                <h3>ğŸ¯ PATTERN RAT</h3>
                <p>Identify the pattern in rat movements to predict the next location!</p>
                <div class="ascii-art">
ğŸ€ â†’ ğŸ§€ â†’ ğŸ€
ğŸ§€ â†’ ğŸ€ â†’ ğŸ§€
ğŸ€ â†’ ğŸ§€ â†’ ?</div>
                <div class="difficulty">DIFFICULTY: MEDIUM</div>
                <button class="btn" onclick="openActivity('pattern')">FIND PATTERN</button>
            </div>

            <!-- Memory Challenge -->
            <div class="menu-item">
                <h3>ğŸ’­ MEMORY TEST</h3>
                <p>Memorize the locations of hidden cheese stashes!</p>
                <div class="ascii-art">
   â—‹_â—‹
  /   \
 | â—‰ â—‰ |
  \ â–¼ /
   |_|
  REMEMBER!</div>
                <div class="difficulty">DIFFICULTY: MEDIUM</div>
                <button class="btn" onclick="openActivity('memory')">TEST MEMORY</button>
            </div>

            <!-- Riddles -->
            <div class="menu-item">
                <h3>â“ RAT RIDDLES</h3>
                <p>Solve ancient rat riddles passed down through generations!</p>
                <div class="ascii-art">
    ~~~
   (o_o)
    \_/
    /|\

"I run but
never walk..."</div>
                <div class="difficulty">DIFFICULTY: EXTREME</div>
                <button class="btn" onclick="openActivity('riddles')">SOLVE RIDDLES</button>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard">
            <h3>ğŸ† BUSHWICK RAT LEADERBOARD ğŸ†</h3>
            <div class="leaderboard-entry">
                <div class="rank">1.</div>
                <div>Pizza Rat Supreme</div>
                <div class="score">9,999 pts</div>
            </div>
            <div class="leaderboard-entry">
                <div class="rank">2.</div>
                <div>Dumpster Diver Deluxe</div>
                <div class="score">8,547 pts</div>
            </div>
            <div class="leaderboard-entry">
                <div class="rank">3.</div>
                <div>Bodega Bandit</div>
                <div class="score">7,823 pts</div>
            </div>
            <div class="leaderboard-entry">
                <div class="rank">4.</div>
                <div>Cheese Connoisseur</div>
                <div class="score">6,234 pts</div>
            </div>
            <div class="leaderboard-entry">
                <div class="rank">5.</div>
                <div>You (New Player)</div>
                <div class="score" id="playerScore">0 pts</div>
            </div>
        </div>

        <div class="footer">
            <p>RAT_BUSHWICK v1.0 | Developed by Whisker Industriesâ„¢</p>
            <p>Remember: A well-fed rat is a happy rat.</p>
            <p style="margin-top: 20px; font-size: 0.8em;">ğŸ€ ğŸ• ğŸ§€ ğŸ—‘ï¸ ğŸ€ ğŸ• ğŸ§€ ğŸ—‘ï¸ ğŸ€ ğŸ• ğŸ§€ ğŸ—‘ï¸</p>
        </div>
    </div>

    <!-- Modal for Activities -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeActivity()">&times;</span>
            <h2 id="modalTitle">MISSION BRIEFING</h2>
            <div id="modalBody"></div>
            <button class="btn" onclick="completeActivity()" style="width: 100%; margin-top: 20px;">COMPLETE MISSION</button>
        </div>
    </div>

    <script>
        let gameState = {
            hunger: 100,
            cheese: 0,
            pizza: 0,
            dives: 0,
            totalScore: 0
        };

        let gameRunning = false;
        let playerX = 190;
        let playerY = 250;
        let pizzas = [];
        let cats = [];
        let cheese = [];
        let gameScore = 0;
        let gameLives = 3;
        let gameLevel = 1;
        let nextLevelScore = 100;
        let playerSpeed = 15;
        let speedBoostTimer = 0;
        let isHiding = false;
        let hideTimer = 0;
        let hideCooldown = 0;
        let gameCanvas = null;
        let gameCtx = null;
        let canvasWidth = 400;
        let canvasHeight = 300;
        let mobileControlsSetup = false;

        const activities = {
            maze: {
                title: "ğŸ§€ CHEESE MAZE PUZZLE",
                ascii: `
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
    â–ˆ ğŸ€ START     â–ˆ
    â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ â–ˆ
    â–ˆ â–ˆ     â–ˆ   â–ˆ â–ˆ
    â–ˆ â–ˆ â–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆ â–ˆ â–ˆ
    â–ˆ â–ˆ â–ˆ â–ˆ     â–ˆ â–ˆ
    â–ˆ â–ˆ â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆ â–ˆ
    â–ˆ â–ˆ          â–ˆ
    â–ˆ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â–ˆ
    â–ˆ FINISH ğŸ§€   â–ˆ
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

    PATH FOUND: â†“â†’â†’â†“â†“â†’â†“â†’â†’â†‘â†’â†“
    SUCCESS!
                `,
                reward: 'Maze solved! +5 cheese, +20 IQ points'
            },
            trivia: {
                title: "ğŸ§  RAT TRIVIA CHALLENGE",
                ascii: `
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ QUESTION 1/5  â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    What year did the
    famous NYC Pizza Rat
    video go viral?

    A) 2014
    B) 2015 âœ“
    C) 2016
    D) 2017

    CORRECT! +10 POINTS
                `,
                reward: 'Perfect score! +15 cheese, +1 achievement'
            },
            math: {
                title: "ğŸ• PIZZA MATH PROBLEM",
                ascii: `
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ CALCULATION   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    8 rats share 3 slices
    Each slice = 8 pieces

    3 Ã— 8 = 24 pieces
    24 Ã· 8 = 3 pieces/rat

    ANSWER: 3 pieces each!
    SOLUTION: CORRECT âœ“
                `,
                reward: 'Math genius! +10 cheese, +25 IQ points'
            },
            scramble: {
                title: "ğŸ“ RAT WORD SCRAMBLE",
                ascii: `
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ UNSCRAMBLE!   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ZZEIP â†’ PIZZA âœ“
    EHSECE â†’ CHEESE âœ“
    ARUBGES â†’ GARBAGE âœ“
    KBWHSCUI â†’ BUSHWICK âœ“

    ALL CORRECT!
    WORD MASTER!
                `,
                reward: 'All words correct! +12 cheese, +1 achievement'
            },
            logic: {
                title: "ğŸ” RAT DETECTIVE LOGIC",
                ascii: `
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ CLUES:        â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    1. Suspect A was sleeping
    2. Suspect B hates pizza
    3. Suspect C loves pizza
    4. Pizza vanished at 2am

    DEDUCTION: Suspect C!
    CASE SOLVED âœ“
                `,
                reward: 'Mystery solved! +18 cheese, Detective Badge unlocked'
            },
            pattern: {
                title: "ğŸ¯ PATTERN RECOGNITION",
                ascii: `
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ FIND PATTERN  â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸ€ â†’ ğŸ§€ â†’ ğŸ€
    ğŸ§€ â†’ ğŸ€ â†’ ğŸ§€
    ğŸ€ â†’ ğŸ§€ â†’ [ğŸ€]

    PATTERN: Alternating!
    ANSWER: ğŸ€ âœ“
    GENIUS LEVEL!
                `,
                reward: 'Pattern mastered! +14 cheese, +30 IQ points'
            },
            memory: {
                title: "ğŸ’­ MEMORY CHALLENGE",
                ascii: `
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ MEMORIZE:     â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    ğŸ§€ â–‘ â–‘ ğŸ§€ â–‘
    â–‘ ğŸ§€ â–‘ â–‘ ğŸ§€
    ğŸ§€ â–‘ ğŸ§€ â–‘ â–‘

    [3 seconds later...]

    ALL LOCATIONS RECALLED!
    PERFECT MEMORY âœ“
                `,
                reward: 'Memory master! +16 cheese, Photographic Memory badge'
            },
            riddles: {
                title: "â“ ANCIENT RAT RIDDLES",
                ascii: `
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘ RIDDLE:       â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    "I run but never walk,
    have a mouth but never talk,
    have a bed but never sleep"

    ANSWER: A RIVER âœ“

    ANCIENT WISDOM UNLOCKED!
                `,
                reward: 'Riddle solved! +20 cheese, Wisdom of the Elders unlocked'
            }
        };

        function openActivity(activity) {
            const data = activities[activity];
            document.getElementById('modalTitle').textContent = data.title;
            document.getElementById('modalBody').innerHTML = `
                <div class="modal-ascii">${data.ascii}</div>
                <p style="margin: 20px 0;">${data.reward}</p>
            `;
            document.getElementById('activityModal').style.display = 'block';
            document.getElementById('activityModal').dataset.activity = activity;
        }

        function closeActivity() {
            document.getElementById('activityModal').style.display = 'none';
        }

        function completeActivity() {
            const activity = document.getElementById('activityModal').dataset.activity;
            const rewards = {
                dumpster: { hunger: -50, cheese: 10, pizza: 0, dives: 1 },
                pizza: { hunger: -60, cheese: 0, pizza: 5, dives: 0 },
                bodega: { hunger: -40, cheese: 15, pizza: 0, dives: 0 },
                bakery: { hunger: -80, cheese: 20, pizza: 0, dives: 0 },
                subway: { hunger: -55, cheese: 8, pizza: 2, dives: 0 },
                taco: { hunger: -70, cheese: 12, pizza: 3, dives: 0 },
                vendor: { hunger: -35, cheese: 6, pizza: 0, dives: 0 },
                rooftop: { hunger: -90, cheese: 25, pizza: 5, dives: 0 }
            };

            const reward = rewards[activity];
            gameState.hunger = Math.max(0, gameState.hunger + reward.hunger);
            gameState.cheese += reward.cheese;
            gameState.pizza += reward.pizza;
            gameState.dives += reward.dives;
            gameState.totalScore += (reward.cheese * 10) + (reward.pizza * 20);

            updateStats();
            closeActivity();

            // Show achievement
            if (gameState.totalScore > 500) {
                showAchievement('RAT_MASTER_UNLOCKED', 'You are now a true Bushwick Rat!');
            }
        }

        function updateStats() {
            document.getElementById('hunger').textContent = gameState.hunger + '%';
            document.getElementById('cheese').textContent = gameState.cheese;
            document.getElementById('pizza').textContent = gameState.pizza;
            document.getElementById('dives').textContent = gameState.dives;
            document.getElementById('playerScore').textContent = gameState.totalScore + ' pts';
        }

        function showAchievement(title, desc) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.innerHTML = `<strong>ğŸ† ${title}</strong><br>${desc}`;
            document.querySelector('.container').insertBefore(achievement, document.querySelector('.menu-grid'));
            setTimeout(() => achievement.remove(), 3000);
        }

        function startGame() {
            gameCanvas = document.getElementById('gameCanvas');
            canvasWidth = gameCanvas.offsetWidth;
            canvasHeight = gameCanvas.offsetHeight;

            // Create actual canvas element
            let canvas = gameCanvas.querySelector('canvas');
            if (!canvas) {
                canvas = document.createElement('canvas');
                canvas.width = canvasWidth;
                canvas.height = canvasHeight;
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                gameCanvas.appendChild(canvas);
            }
            gameCtx = canvas.getContext('2d');

            gameRunning = true;
            gameScore = 0;
            gameLives = 3;
            gameLevel = 1;
            nextLevelScore = 100;
            playerSpeed = 15;
            speedBoostTimer = 0;
            isHiding = false;
            hideTimer = 0;
            hideCooldown = 0;
            playerX = canvasWidth / 2 - 10;
            playerY = canvasHeight - 40;
            pizzas = [];
            cats = [];
            cheese = [];

            // Generate initial pizzas
            for (let i = 0; i < 5; i++) {
                spawnPizza();
            }

            // Spawn initial cat
            spawnCat();

            // Spawn cheese power-up
            spawnCheese();

            // Remove old listener first, then add new one
            document.removeEventListener('keydown', handleGameInput);
            document.addEventListener('keydown', handleGameInput);

            // Setup mobile controls (only once)
            if (!mobileControlsSetup) {
                setupMobileControls();
                mobileControlsSetup = true;
            }

            updateGameUI();
            gameLoop();
        }

        function spawnPizza() {
            pizzas.push({
                x: Math.random() * (canvasWidth - 25),
                y: Math.random() * (canvasHeight - 25)
            });
        }

        function spawnCat() {
            const side = Math.floor(Math.random() * 4);
            let x, y, vx, vy;
            const speed = 0.5 + (gameLevel * 0.15);

            switch(side) {
                case 0: // top
                    x = Math.random() * canvasWidth;
                    y = 0;
                    vx = (Math.random() - 0.5) * speed;
                    vy = Math.random() * speed;
                    break;
                case 1: // right
                    x = canvasWidth;
                    y = Math.random() * canvasHeight;
                    vx = -Math.random() * speed;
                    vy = (Math.random() - 0.5) * speed;
                    break;
                case 2: // bottom
                    x = Math.random() * canvasWidth;
                    y = canvasHeight;
                    vx = (Math.random() - 0.5) * speed;
                    vy = -Math.random() * speed;
                    break;
                default: // left
                    x = 0;
                    y = Math.random() * canvasHeight;
                    vx = Math.random() * speed;
                    vy = (Math.random() - 0.5) * speed;
            }

            cats.push({ x, y, vx, vy, size: 25 });
        }

        function spawnCheese() {
            if (cheese.length < 2) {
                cheese.push({
                    x: Math.random() * (canvasWidth - 20),
                    y: Math.random() * (canvasHeight - 20),
                    timer: 300
                });
            }
        }

        function setupMobileControls() {
            const buttons = document.querySelectorAll('.game-control-btn[data-dir]');
            buttons.forEach(btn => {
                const dir = btn.dataset.dir;

                // Touch events
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    movePlayer(dir);
                });

                // Click events for desktop testing
                btn.addEventListener('click', () => movePlayer(dir));
            });

            // Hide button
            const hideBtn = document.getElementById('hideBtn');
            hideBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                toggleHide();
            });
            hideBtn.addEventListener('click', toggleHide);
        }

        function toggleHide() {
            if (!gameRunning || hideCooldown > 0) return;

            if (!isHiding) {
                isHiding = true;
                hideTimer = 120; // 2 seconds at 60fps
                hideCooldown = 300; // 5 second cooldown
            }
        }

        function movePlayer(dir) {
            if (!gameRunning) return;
            const speed = speedBoostTimer > 0 ? playerSpeed * 1.5 : playerSpeed;

            switch(dir) {
                case 'up':
                    if (playerY > 0) playerY -= speed;
                    break;
                case 'down':
                    if (playerY < canvasHeight - 20) playerY += speed;
                    break;
                case 'left':
                    if (playerX > 0) playerX -= speed;
                    break;
                case 'right':
                    if (playerX < canvasWidth - 20) playerX += speed;
                    break;
            }
        }

        function handleGameInput(e) {
            if (!gameRunning) return;

            const dirMap = {
                'ArrowUp': 'up', 'w': 'up', 'W': 'up',
                'ArrowDown': 'down', 's': 'down', 'S': 'down',
                'ArrowLeft': 'left', 'a': 'left', 'A': 'left',
                'ArrowRight': 'right', 'd': 'right', 'D': 'right'
            };

            if (dirMap[e.key]) {
                e.preventDefault();
                movePlayer(dirMap[e.key]);
            } else if (e.key === ' ') {
                e.preventDefault();
                toggleHide();
            }
        }

        function updateGameUI() {
            document.getElementById('gameScore').textContent = gameScore;
            document.getElementById('gameLives').textContent = gameLives;
            document.getElementById('gameLevel').textContent = gameLevel;
        }

        function checkCollision(ax, ay, aw, ah, bx, by, bw, bh) {
            return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
        }

        function gameLoop() {
            if (!gameRunning) return;

            // Clear canvas with noir background
            gameCtx.fillStyle = '#0a0a0a';
            gameCtx.fillRect(0, 0, canvasWidth, canvasHeight);

            // Draw grid
            gameCtx.strokeStyle = 'rgba(126, 200, 227, 0.1)';
            gameCtx.lineWidth = 1;
            for (let i = 0; i < canvasWidth; i += 20) {
                gameCtx.beginPath();
                gameCtx.moveTo(i, 0);
                gameCtx.lineTo(i, canvasHeight);
                gameCtx.stroke();
            }
            for (let i = 0; i < canvasHeight; i += 20) {
                gameCtx.beginPath();
                gameCtx.moveTo(0, i);
                gameCtx.lineTo(canvasWidth, i);
                gameCtx.stroke();
            }

            // Speed boost timer
            if (speedBoostTimer > 0) {
                speedBoostTimer--;
                // Draw speed indicator
                gameCtx.fillStyle = '#ffbe0b';
                gameCtx.fillRect(10, 10, (speedBoostTimer / 180) * 100, 8);
            }

            // Draw and update pizzas (iterate backwards to safely remove)
            for (let i = pizzas.length - 1; i >= 0; i--) {
                const pizza = pizzas[i];
                // Pizza slice triangle
                gameCtx.fillStyle = '#ff9500';
                gameCtx.beginPath();
                gameCtx.moveTo(pizza.x + 10, pizza.y);
                gameCtx.lineTo(pizza.x + 20, pizza.y + 20);
                gameCtx.lineTo(pizza.x, pizza.y + 20);
                gameCtx.closePath();
                gameCtx.fill();
                gameCtx.strokeStyle = '#ffb700';
                gameCtx.lineWidth = 2;
                gameCtx.stroke();

                // Check collision with player
                if (checkCollision(playerX, playerY, 20, 20, pizza.x, pizza.y, 20, 20)) {
                    gameScore += 10 * gameLevel;
                    pizzas.splice(i, 1);
                    spawnPizza();

                    // Level up when reaching threshold
                    if (gameScore >= nextLevelScore) {
                        gameLevel++;
                        nextLevelScore += 100 * gameLevel; // Increasing threshold
                        spawnCat();
                    }

                    updateGameUI();
                }
            }

            // Draw and update cheese power-ups (iterate backwards)
            for (let i = cheese.length - 1; i >= 0; i--) {
                const c = cheese[i];
                c.timer--;
                if (c.timer <= 0) {
                    cheese.splice(i, 1);
                    continue;
                }

                // Flashing when about to disappear
                if (c.timer < 60 && Math.floor(c.timer / 10) % 2 === 0) continue;

                // Draw cheese wedge
                gameCtx.fillStyle = '#ffbe0b';
                gameCtx.beginPath();
                gameCtx.arc(c.x + 10, c.y + 10, 10, 0, Math.PI * 2);
                gameCtx.fill();
                gameCtx.fillStyle = '#0a0a0a';
                gameCtx.beginPath();
                gameCtx.arc(c.x + 8, c.y + 8, 2, 0, Math.PI * 2);
                gameCtx.arc(c.x + 14, c.y + 12, 2, 0, Math.PI * 2);
                gameCtx.fill();

                // Check collision
                if (checkCollision(playerX, playerY, 20, 20, c.x, c.y, 20, 20)) {
                    speedBoostTimer = 180; // 3 seconds at 60fps
                    cheese.splice(i, 1);
                    gameScore += 25;
                    updateGameUI();
                }
            }

            // Spawn cheese occasionally
            if (Math.random() < 0.003) spawnCheese();

            // Draw and update cats (enemies) - iterate backwards for safe removal
            let playerHit = false;
            for (let i = cats.length - 1; i >= 0; i--) {
                const cat = cats[i];
                // Move cat towards player (simple AI)
                const dx = playerX - cat.x;
                const dy = playerY - cat.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist > 0) {
                    cat.vx = (dx / dist) * (0.6 + gameLevel * 0.1);
                    cat.vy = (dy / dist) * (0.6 + gameLevel * 0.1);
                }

                cat.x += cat.vx;
                cat.y += cat.vy;

                // Draw cat
                gameCtx.fillStyle = '#ff0000';
                // Body
                gameCtx.beginPath();
                gameCtx.ellipse(cat.x + 12, cat.y + 15, 12, 10, 0, 0, Math.PI * 2);
                gameCtx.fill();
                // Head
                gameCtx.beginPath();
                gameCtx.arc(cat.x + 20, cat.y + 10, 8, 0, Math.PI * 2);
                gameCtx.fill();
                // Ears
                gameCtx.beginPath();
                gameCtx.moveTo(cat.x + 15, cat.y + 5);
                gameCtx.lineTo(cat.x + 18, cat.y - 2);
                gameCtx.lineTo(cat.x + 21, cat.y + 5);
                gameCtx.fill();
                gameCtx.beginPath();
                gameCtx.moveTo(cat.x + 22, cat.y + 5);
                gameCtx.lineTo(cat.x + 25, cat.y - 2);
                gameCtx.lineTo(cat.x + 28, cat.y + 5);
                gameCtx.fill();
                // Eyes
                gameCtx.fillStyle = '#ffbe0b';
                gameCtx.beginPath();
                gameCtx.arc(cat.x + 18, cat.y + 9, 2, 0, Math.PI * 2);
                gameCtx.arc(cat.x + 24, cat.y + 9, 2, 0, Math.PI * 2);
                gameCtx.fill();

                // Check collision with player (only once per frame) - skip if hiding
                if (!playerHit && !isHiding && checkCollision(playerX, playerY, 20, 20, cat.x, cat.y, cat.size, cat.size)) {
                    playerHit = true;
                    gameLives--;
                    updateGameUI();

                    if (gameLives <= 0) {
                        endGame();
                        return; // Stop the game loop
                    }

                    // Reset player position
                    playerX = canvasWidth / 2 - 10;
                    playerY = canvasHeight - 40;

                    // Remove this cat and spawn new one after delay
                    cats.splice(i, 1);
                    setTimeout(spawnCat, 1000);
                }
            }

            // Update hiding and cooldown timers
            if (hideTimer > 0) {
                hideTimer--;
                if (hideTimer === 0) {
                    isHiding = false;
                }
            }
            if (hideCooldown > 0) {
                hideCooldown--;
            }

            // Draw player (rat) with speed boost and hiding effects
            const ratColor = speedBoostTimer > 0 ? '#7ec8e3' : '#ff006e';

            // Hiding indicator - draw box around rat
            if (isHiding) {
                gameCtx.fillStyle = 'rgba(255, 85, 255, 0.3)';
                gameCtx.fillRect(playerX - 5, playerY - 5, 30, 30);
                gameCtx.strokeStyle = '#ff55ff';
                gameCtx.lineWidth = 2;
                gameCtx.strokeRect(playerX - 5, playerY - 5, 30, 30);
                gameCtx.globalAlpha = 0.5; // Semi-transparent when hiding
            }

            gameCtx.fillStyle = ratColor;

            // Body
            gameCtx.beginPath();
            gameCtx.arc(playerX + 10, playerY + 12, 10, 0, Math.PI * 2);
            gameCtx.fill();

            // Ears
            gameCtx.beginPath();
            gameCtx.arc(playerX + 5, playerY + 2, 5, 0, Math.PI * 2);
            gameCtx.fill();
            gameCtx.beginPath();
            gameCtx.arc(playerX + 15, playerY + 2, 5, 0, Math.PI * 2);
            gameCtx.fill();

            // Eye
            gameCtx.fillStyle = '#000';
            gameCtx.beginPath();
            gameCtx.arc(playerX + 12, playerY + 10, 2, 0, Math.PI * 2);
            gameCtx.fill();

            // Nose
            gameCtx.fillStyle = '#ff006e';
            gameCtx.beginPath();
            gameCtx.arc(playerX + 18, playerY + 12, 2, 0, Math.PI * 2);
            gameCtx.fill();

            // Tail
            gameCtx.strokeStyle = ratColor;
            gameCtx.lineWidth = 3;
            gameCtx.beginPath();
            gameCtx.moveTo(playerX + 2, playerY + 18);
            gameCtx.quadraticCurveTo(playerX - 15, playerY + 25, playerX - 20, playerY + 15);
            gameCtx.stroke();

            gameCtx.globalAlpha = 1.0; // Reset opacity

            // Display hide cooldown/timer
            if (isHiding || hideCooldown > 0) {
                gameCtx.font = '14px VT323';
                gameCtx.textAlign = 'center';
                if (isHiding) {
                    gameCtx.fillStyle = '#ff55ff';
                    gameCtx.fillText(`HIDING: ${Math.ceil(hideTimer / 60)}s`, canvasWidth / 2, 30);
                } else if (hideCooldown > 0) {
                    gameCtx.fillStyle = '#00ff9f';
                    gameCtx.fillText(`Hide Ready: ${Math.ceil(hideCooldown / 60)}s`, canvasWidth / 2, 30);
                }
                gameCtx.textAlign = 'left';
            }

            requestAnimationFrame(gameLoop);
        }

        function endGame() {
            gameRunning = false;
            document.removeEventListener('keydown', handleGameInput);

            // Draw game over screen
            gameCtx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            gameCtx.fillRect(0, 0, canvasWidth, canvasHeight);

            gameCtx.fillStyle = '#ff0000';
            gameCtx.font = 'bold 24px VT323';
            gameCtx.textAlign = 'center';
            gameCtx.fillText('GAME OVER', canvasWidth / 2, canvasHeight / 2 - 30);

            gameCtx.fillStyle = '#7ec8e3';
            gameCtx.font = '18px VT323';
            gameCtx.fillText(`Final Score: ${gameScore}`, canvasWidth / 2, canvasHeight / 2);
            gameCtx.fillText(`Level Reached: ${gameLevel}`, canvasWidth / 2, canvasHeight / 2 + 25);
            gameCtx.fillText('Click START to play again', canvasWidth / 2, canvasHeight / 2 + 60);
            gameCtx.textAlign = 'left';

            // Add score to game state
            gameState.pizza += Math.floor(gameScore / 10);
            gameState.totalScore += gameScore;
            updateStats();
        }

        function stopGame() {
            gameRunning = false;
            document.removeEventListener('keydown', handleGameInput);
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('activityModal');
            if (event.target === modal) {
                closeActivity();
            }
        }

        // Initialize
        updateStats();

        // Hunger decreases over time
        setInterval(() => {
            if (gameState.hunger > 0) {
                gameState.hunger = Math.max(0, gameState.hunger - 1);
                updateStats();
            }
        }, 5000);
    </script>
</body>
</html>