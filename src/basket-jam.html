<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basket Jam</title>
    <link rel="stylesheet" href="../page-theme.css">
    <style>
        body {
            padding-top: 80px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            overflow-y: auto;
        }

        .game-title {
            text-align: center;
            margin-bottom: 15px;
        }

        .game-title h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 8px;
            color: #ff6b00;
            text-shadow: 0 0 15px rgba(255, 107, 0, 0.6);
        }

        .subtitle {
            color: #7ec8e3;
            font-size: 1.1em;
            margin: 0;
        }

        .stats-panel {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ffff;
            padding: 12px 20px;
            min-width: 100px;
            text-align: center;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .stat-box.highlight {
            border-color: #ff6b00;
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.5);
            transform: scale(1.05);
        }

        .stat-label {
            font-size: 0.9em;
            color: #00ffff;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.8em;
            color: #fff;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .game-container {
            position: relative;
            width: min(400px, 95vw);
            height: 600px;
            border: 3px solid #ff6b00;
            background: linear-gradient(180deg, #001122 0%, #000511 100%);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(255, 107, 0, 0.3);
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            color: #ff6b00;
            text-shadow: 0 0 20px rgba(255, 107, 0, 0.8);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 10;
            text-align: center;
            font-weight: bold;
        }

        .game-message.show {
            opacity: 1;
            animation: messageFloat 1s ease-out;
        }

        @keyframes messageFloat {
            0% { transform: translate(-50%, -50%) scale(0.8); }
            50% { transform: translate(-50%, -60%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
            margin-top: 15px;
        }

        .aim-controls {
            display: grid;
            grid-template-columns: repeat(3, 60px);
            gap: 8px;
            margin-bottom: 10px;
        }

        .aim-btn {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            background: rgba(0, 255, 255, 0.2);
            border: 2px solid #00ffff;
            color: #00ffff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
        }

        .aim-btn:hover {
            background: rgba(0, 255, 255, 0.4);
            transform: scale(1.05);
        }

        .aim-btn:active {
            transform: scale(0.95);
            background: rgba(255, 107, 0, 0.6);
        }

        .aim-btn.empty {
            visibility: hidden;
        }

        .power-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .power-btn {
            padding: 12px 20px;
            background: rgba(255, 107, 0, 0.3);
            border: 2px solid #ff6b00;
            color: #ff6b00;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-weight: bold;
            touch-action: manipulation;
            user-select: none;
        }

        .power-btn:hover {
            background: rgba(255, 107, 0, 0.5);
        }

        .power-btn:active {
            transform: scale(0.95);
        }

        .power-display {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ffff;
            padding: 10px 20px;
            border-radius: 8px;
            color: #00ffff;
            font-weight: bold;
            min-width: 120px;
            text-align: center;
        }

        .shoot-btn {
            padding: 15px 40px;
            background: rgba(255, 0, 0, 0.8);
            border: 3px solid #ff0000;
            color: #fff;
            font-size: 1.3em;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.15s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            touch-action: manipulation;
            user-select: none;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
        }

        .shoot-btn:hover {
            background: rgba(255, 0, 0, 1);
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.6);
            transform: scale(1.05);
        }

        .shoot-btn:active {
            transform: scale(0.98);
        }

        .game-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .control-btn {
            padding: 10px 20px;
            background: rgba(126, 200, 227, 0.2);
            border: 2px solid #7ec8e3;
            color: #7ec8e3;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-weight: bold;
            touch-action: manipulation;
            user-select: none;
        }

        .control-btn:hover {
            background: rgba(126, 200, 227, 0.4);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .instructions {
            max-width: 500px;
            text-align: center;
            margin: 20px auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #00ffff;
            border-radius: 12px;
            line-height: 1.6;
        }

        .instructions strong {
            color: #ff6b00;
        }

        @media (max-width: 768px) {
            body {
                padding-top: 70px;
            }

            .stats-panel {
                gap: 15px;
            }

            .stat-box {
                min-width: 80px;
                padding: 10px 15px;
            }

            .stat-value {
                font-size: 1.5em;
            }

            .aim-btn {
                width: 55px;
                height: 55px;
                font-size: 1.3rem;
            }

            .power-controls {
                gap: 10px;
            }

            .power-btn {
                padding: 10px 15px;
                font-size: 0.9em;
            }

            .power-display {
                min-width: 100px;
                padding: 8px 15px;
            }

            .shoot-btn {
                padding: 12px 30px;
                font-size: 1.1em;
            }
        }

        @media (max-width: 480px) {
            .aim-controls {
                grid-template-columns: repeat(3, 50px);
                gap: 6px;
            }

            .aim-btn {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .stats-panel {
                gap: 10px;
            }

            .stat-box {
                min-width: 70px;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <a href="../index.html" class="home-link">‚Üê HOME</a>

    <div class="game-title">
        <h1>üèÄ BASKET JAM</h1>
        <p class="subtitle">Precision hoops challenge</p>
    </div>

    <div class="stats-panel">
        <div class="stat-box" id="scoreBox">
            <div class="stat-label">Score</div>
            <div class="stat-value" id="score">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Shots</div>
            <div class="stat-value" id="shots">0</div>
        </div>
        <div class="stat-box" id="streakBox">
            <div class="stat-label">Streak</div>
            <div class="stat-value" id="streak">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Accuracy</div>
            <div class="stat-value" id="accuracy">0%</div>
        </div>
    </div>

    <div class="game-container">
        <canvas id="gameCanvas" width="400" height="600"></canvas>
        <div class="game-message" id="gameMessage"></div>
    </div>

    <div class="controls-panel">
        <div class="aim-controls">
            <div class="aim-btn empty"></div>
            <button class="aim-btn" id="aimUp">‚Üë</button>
            <div class="aim-btn empty"></div>
            <button class="aim-btn" id="aimLeft">‚Üê</button>
            <div class="aim-btn" style="border: 2px dashed #555; color: #555;">‚ö¨</div>
            <button class="aim-btn" id="aimRight">‚Üí</button>
            <div class="aim-btn empty"></div>
            <button class="aim-btn" id="aimDown">‚Üì</button>
            <div class="aim-btn empty"></div>
        </div>

        <div class="power-controls">
            <button class="power-btn" id="powerDown">Power -</button>
            <div class="power-display">
                <span>Power: </span><span id="powerValue">50</span>%
            </div>
            <button class="power-btn" id="powerUp">Power +</button>
        </div>

        <button class="shoot-btn" id="shootBtn">üèÄ SHOOT!</button>
    </div>

    <div class="game-controls">
        <button class="control-btn" id="pauseBtn">PAUSE</button>
        <button class="control-btn" id="resetBtn">RESET</button>
    </div>

    <div class="instructions">
        <p><strong>Desktop:</strong> Use arrow keys or WASD to aim, Q/E to adjust power, SPACE to shoot, P to pause.</p>
        <p><strong>Mobile:</strong> Use the control buttons to aim and adjust power, then tap SHOOT!</p>
        <p><strong>Scoring:</strong> Hit the basket for points. Build streaks for bonus multipliers!</p>
    </div>

    <script type="module">
        import kaboom from "https://unpkg.com/kaboom/dist/kaboom.mjs";

        // Initialize Kaboom
        const k = kaboom({
            canvas: document.getElementById('gameCanvas'),
            width: 400,
            height: 600,
            background: [0, 17, 34],
            letterbox: true,
            touchToMouse: false
        });

        // Game state
        const game = {
            score: 0,
            shots: 0,
            streak: 0,
            bestStreak: 0,
            angle: 45,
            power: 50,
            ballInPlay: false,
            paused: false,
            player: null,
            basket: null,
            rim: null,
            backboard: null,
            net: [],
            aimLine: null,
            particles: []
        };
        
        // DOM elements
        const elements = {
            score: document.getElementById('score'),
            shots: document.getElementById('shots'),
            streak: document.getElementById('streak'),
            accuracy: document.getElementById('accuracy'),
            powerValue: document.getElementById('powerValue'),
            gameMessage: document.getElementById('gameMessage'),
            scoreBox: document.getElementById('scoreBox'),
            streakBox: document.getElementById('streakBox')
        };

        // Utility functions
        function clamp(value, min, max) {
            return Math.max(min, Math.min(max, value));
        }

        function updateStats() {
            elements.score.textContent = game.score;
            elements.shots.textContent = game.shots;
            elements.streak.textContent = game.streak;
            elements.powerValue.textContent = game.power;
            
            const accuracy = game.shots > 0 ? Math.round((game.score / (game.shots * 2)) * 100) : 0;
            elements.accuracy.textContent = accuracy + '%';
        }

        function showMessage(text, duration = 2000) {
            elements.gameMessage.textContent = text;
            elements.gameMessage.classList.add('show');
            setTimeout(() => {
                elements.gameMessage.classList.remove('show');
            }, duration);
        }

        function highlightStat(element) {
            element.classList.add('highlight');
            setTimeout(() => {
                element.classList.remove('highlight');
            }, 600);
        }

        // Create game objects
        function createGameObjects() {
            // Court floor line
            k.add([
                k.pos(0, k.height() - 100),
                k.rect(k.width(), 3),
                k.color(255, 255, 255),
                k.opacity(0.8),
                'court'
            ]);

            // Backboard
            game.backboard = k.add([
                k.pos(350, 80),
                k.rect(8, 50),
                k.color(255, 255, 255),
                k.area({ shape: new k.Rect(k.vec2(0, 0), 8, 50) }),
                'backboard'
            ]);

            // Rim
            game.rim = k.add([
                k.pos(320, 120),
                k.rect(60, 8),
                k.color(255, 107, 0),
                k.area({ shape: new k.Rect(k.vec2(0, 0), 60, 8) }),
                'rim'
            ]);

            // Basket scoring zone (invisible)
            game.basket = k.add([
                k.pos(325, 128),
                k.rect(50, 15),
                k.area({ shape: new k.Rect(k.vec2(0, 0), 50, 15) }),
                k.opacity(0),
                'basket'
            ]);

            // Net strands
            for (let i = 0; i < 6; i++) {
                const x = 325 + (i * 8);
                game.net.push(k.add([
                    k.pos(x, 128),
                    k.rect(2, 25),
                    k.color(200, 200, 200),
                    k.opacity(0.7)
                ]));
            }

            // Player launcher
            game.player = k.add([
                k.pos(200, 550),
                k.rect(30, 10),
                k.color(126, 200, 227),
                k.anchor('center'),
                'player'
            ]);

            // Initial aim line creation
            updateAimLine();
        }

        function createParticleEffect(x, y, color = [0, 255, 0]) {
            for (let i = 0; i < 12; i++) {
                const particle = k.add([
                    k.pos(x, y),
                    k.circle(3),
                    k.color(color[0], color[1], color[2]),
                    k.opacity(1),
                    k.lifespan(1),
                    k.move(k.rand(0, 360), k.rand(50, 150))
                ]);
                
                particle.onUpdate(() => {
                    particle.opacity -= k.dt() * 2;
                });
            }
        }

        function updateAimLine() {
            if (game.aimLine) game.aimLine.destroy();
            if (game.ballInPlay || game.paused) return;

            // Calculate trajectory
            const angle = k.deg2rad(game.angle);
            const velocity = (game.power / 100) * 18;
            const vx = velocity * Math.cos(angle);
            const vy = -velocity * Math.sin(angle);
            
            const points = [];
            let x = game.player.pos.x;
            let y = game.player.pos.y - 20;
            
            // Simulate trajectory points
            for (let step = 0; step < 60; step++) {
                points.push(k.vec2(x, y));
                x += vx * 0.5;
                y += vy * 0.5;
                vy += 800 * 0.5 * k.dt();
                
                if (y > k.height() || x < 0 || x > k.width()) break;
            }
            
            // Create dotted aim line
            game.aimLine = k.add([
                k.pos(0, 0),
                k.opacity(0.7),
                k.z(1),
                {
                    draw() {
                        for (let i = 0; i < points.length; i += 4) {
                            const point = points[i];
                            const alpha = 1 - (i / points.length);
                            k.drawCircle({
                                pos: point,
                                radius: 2,
                                color: k.rgb(255, 107, 0),
                                opacity: alpha * 0.8
                            });
                        }
                    }
                }
            ]);
        }

        function shootBall() {
            if (game.ballInPlay || game.paused) return;

            game.ballInPlay = true;
            game.shots++;
            
            // Calculate initial velocity
            const angle = k.deg2rad(game.angle);
            const velocity = (game.power / 100) * 18;
            const vx = velocity * Math.cos(angle);
            const vy = -velocity * Math.sin(angle);

            // Create ball
            const ball = k.add([
                k.pos(game.player.pos.x, game.player.pos.y - 20),
                k.circle(12),
                k.color(255, 107, 0),
                k.outline(2, k.rgb(255, 150, 0)),
                k.area(),
                k.body({ mass: 1 }),
                k.z(10),
                'ball'
            ]);

            ball.vel = k.vec2(vx, vy);
            ball.scored = false;
            
            // Add spin effect
            ball.onUpdate(() => {
                ball.angle += ball.vel.x * 0.001;
                
                // Trail effect - create occasional particles
                if (k.chance(0.3)) {
                    const trail = k.add([
                        k.pos(ball.pos),
                        k.circle(6),
                        k.color(255, 107, 0),
                        k.opacity(0.5),
                        k.lifespan(0.3),
                        k.z(5)
                    ]);
                    trail.onUpdate(() => {
                        trail.opacity -= k.dt() * 3;
                    });
                }

                // Boundary checks
                if (ball.pos.x < 12 || ball.pos.x > k.width() - 12) {
                    ball.vel.x *= -0.7;
                    ball.pos.x = clamp(ball.pos.x, 12, k.width() - 12);
                }

                // Ground check
                if (ball.pos.y > k.height() + 50) {
                    ball.destroy();
                    game.ballInPlay = false;
                    if (game.streak > 0) {
                        showMessage('MISS!');
                        game.streak = 0;
                        updateStats();
                    }
                    updateAimLine();
                }
            });

            // Collision with rim
            ball.onCollide('rim', () => {
                ball.vel.y = Math.abs(ball.vel.y) * 0.6;
                ball.vel.x *= 0.8;
                createParticleEffect(ball.pos.x, ball.pos.y, [255, 170, 0]);
            });

            // Collision with backboard
            ball.onCollide('backboard', () => {
                ball.vel.x *= -0.7;
                createParticleEffect(ball.pos.x, ball.pos.y, [255, 255, 255]);
            });

            // Scoring
            ball.onCollide('basket', () => {
                if (ball.vel.y > 0 && !ball.scored) {
                    ball.scored = true;
                    scoreBasket();
                    ball.destroy();
                    game.ballInPlay = false;
                    updateAimLine();
                }
            });

            // Clean up after timeout
            k.wait(5, () => {
                if (ball.exists() && !ball.scored) {
                    ball.destroy();
                    game.ballInPlay = false;
                    if (game.streak > 0) {
                        showMessage('MISS!');
                        game.streak = 0;
                        updateStats();
                    }
                    updateAimLine();
                }
            });

            updateStats();
            if (game.aimLine) game.aimLine.destroy();
        }

        function scoreBasket() {
            const basePoints = 2;
            const streakMultiplier = Math.min(Math.floor(game.streak / 3) + 1, 5);
            const points = basePoints * streakMultiplier;
            
            game.score += points;
            game.streak++;
            game.bestStreak = Math.max(game.bestStreak, game.streak);
            
            // Visual feedback
            highlightStat(elements.scoreBox);
            highlightStat(elements.streakBox);
            createParticleEffect(game.basket.pos.x + 25, game.basket.pos.y, [0, 255, 0]);
            
            // Show message based on streak
            if (game.streak === 1) {
                showMessage(`SWISH! +${points}`);
            } else if (game.streak < 5) {
                showMessage(`STREAK ${game.streak}! +${points}`);
            } else {
                showMessage(`ON FIRE! +${points} √ó${streakMultiplier}`);
            }
            
            updateStats();
        }

        // Game update loop
        k.onUpdate(() => {
            if (!game.paused && !game.ballInPlay) {
                updateAimLine();
            }
        });

        // Draw angle and power indicators
        k.onDraw(() => {
            if (!game.ballInPlay && !game.paused) {
                k.drawText({
                    text: `${Math.round(game.angle)}¬∞`,
                    pos: k.vec2(game.player.pos.x + 25, game.player.pos.y - 40),
                    color: k.rgb(0, 255, 255),
                    size: 14
                });
                k.drawText({
                    text: `${game.power}%`,
                    pos: k.vec2(game.player.pos.x + 25, game.player.pos.y - 25),
                    color: k.rgb(0, 255, 255),
                    size: 14
                });
            }
        });

        function adjustAngle(delta) {
            if (game.ballInPlay || game.paused) return;
            game.angle = clamp(game.angle + delta, 15, 75);
            updateStats();
        }

        function adjustPower(delta) {
            if (game.ballInPlay || game.paused) return;
            game.power = clamp(game.power + delta, 20, 100);
            updateStats();
        }

        function movePlayer(delta) {
            if (game.ballInPlay || game.paused) return;
            const newX = clamp(game.player.pos.x + delta, 30, k.width() - 30);
            game.player.pos.x = newX;
        }

        function togglePause() {
            game.paused = !game.paused;
            showMessage(game.paused ? 'PAUSED' : 'RESUMED', 1000);
        }

        function resetGame() {
            // Clear existing game objects
            k.destroyAll('ball');
            
            game.score = 0;
            game.shots = 0;
            game.streak = 0;
            game.ballInPlay = false;
            game.angle = 45;
            game.power = 50;
            game.paused = false;
            
            // Reset player position
            if (game.player) {
                game.player.pos.x = 200;
                game.player.pos.y = 550;
            }
            
            updateStats();
            showMessage('RESET!', 1000);
        }

        // Keyboard controls
        k.onKeyPress('space', shootBall);
        k.onKeyPress('p', togglePause);
        k.onKeyDown('up', () => adjustAngle(2));
        k.onKeyDown('down', () => adjustAngle(-2));
        k.onKeyDown('left', () => movePlayer(-3));
        k.onKeyDown('right', () => movePlayer(3));
        k.onKeyDown('w', () => adjustAngle(2));
        k.onKeyDown('s', () => adjustAngle(-2));
        k.onKeyDown('a', () => movePlayer(-3));
        k.onKeyDown('d', () => movePlayer(3));
        k.onKeyDown('q', () => adjustPower(-2));
        k.onKeyDown('e', () => adjustPower(2));

        // Mobile controls
        document.getElementById('aimUp').addEventListener('click', () => adjustAngle(3));
        document.getElementById('aimDown').addEventListener('click', () => adjustAngle(-3));
        document.getElementById('aimLeft').addEventListener('click', () => movePlayer(-10));
        document.getElementById('aimRight').addEventListener('click', () => movePlayer(10));
        document.getElementById('powerUp').addEventListener('click', () => adjustPower(5));
        document.getElementById('powerDown').addEventListener('click', () => adjustPower(-5));
        document.getElementById('shootBtn').addEventListener('click', shootBall);
        document.getElementById('pauseBtn').addEventListener('click', togglePause);
        document.getElementById('resetBtn').addEventListener('click', resetGame);

        // Touch events for mobile
        function setupTouchEvents() {
            const buttons = ['aimUp', 'aimDown', 'aimLeft', 'aimRight', 'powerUp', 'powerDown', 'shootBtn'];
            
            buttons.forEach(id => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        btn.click();
                    }, { passive: false });
                }
            });
        }

        // Set up gravity
        k.setGravity(800);

        // Initialize game
        createGameObjects();
        updateStats();
        setupTouchEvents();
    </script>
    <script src="../stars.js" defer></script>
</body>
</html>