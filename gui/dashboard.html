<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Logging - Bot Sportello</title>
    <link rel="icon" type="image/jpeg" href="../default.jpg">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Courier Prime', monospace;
            background: #0a0a0a;
            color: #7ec8e3;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            border-bottom: 2px solid #00ffff;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand { display: flex; align-items: center; gap: 10px; }
        .logo-thumb { width: 36px; height: 36px; border-radius: 4px; object-fit: cover; border: 1px solid rgba(126, 200, 227, 0.3); }
        .title { font-size: 1.5em; font-weight: bold; color: #00ffff; text-shadow: 0 0 10px rgba(0, 255, 255, 0.5); }

        .status { display: flex; gap: 20px; align-items: center; }
        .status-item { display: flex; align-items: center; gap: 5px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #00ff41; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .nav-link { color: #00ffff; text-decoration: none; padding: 8px 16px; border: 1px solid #00ffff; font-size: 0.85em; transition: all 0.2s; }
        .nav-link:hover { background: rgba(0, 255, 255, 0.15); }

        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 12px; padding: 12px; }
            .title { font-size: 1.1em; }
            .status { flex-wrap: wrap; justify-content: center; gap: 8px; }
            .status-item { font-size: 0.8em; }
            .tabs { overflow-x: auto; }
            .tab { padding: 8px 12px; font-size: 0.8em; white-space: nowrap; }
        }

        /* Tabs */
        .tabs { display: flex; background: #1a1a1a; border-bottom: 1px solid #333; }
        .tab { padding: 10px 20px; cursor: pointer; border: none; background: transparent; color: #7ec8e3; font-family: inherit; font-size: 0.9em; position: relative; transition: all 0.3s; }
        .tab:hover { background: rgba(0, 255, 255, 0.1); }
        .tab.active { color: #00ffff; background: rgba(0, 255, 255, 0.05); }
        .tab.active::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px; background: #00ffff; }
        .tab-count { background: rgba(255, 0, 0, 0.2); color: #ff0000; padding: 2px 6px; border-radius: 10px; font-size: 0.8em; margin-left: 5px; }

        /* Panels */
        .main-content { flex: 1; display: flex; overflow: hidden; }
        .panel { flex: 1; display: none; flex-direction: column; overflow: hidden; }
        .panel.active { display: flex; }

        .panel-header { padding: 10px 15px; background: rgba(255, 0, 0, 0.05); border-bottom: 1px solid rgba(255, 0, 0, 0.2); display: flex; justify-content: space-between; align-items: center; }
        .panel-title { color: #ff0000; font-weight: bold; }
        .panel-actions { display: flex; gap: 10px; }

        .btn { background: rgba(0, 255, 255, 0.1); border: 1px solid #00ffff; color: #00ffff; padding: 5px 10px; cursor: pointer; font-family: inherit; font-size: 0.85em; transition: all 0.3s; }
        .btn:hover { background: rgba(0, 255, 255, 0.2); box-shadow: 0 0 10px rgba(0, 255, 255, 0.3); }

        .log-container { flex: 1; overflow-y: auto; padding: 10px; font-size: 0.85em; }

        /* Log Entries */
        .log-entry { margin-bottom: 10px; padding: 8px; background: rgba(255, 255, 255, 0.02); border-left: 3px solid #333; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .log-entry:hover { background: rgba(255, 255, 255, 0.05); border-left-color: #00ffff; }
        .log-entry.error { border-left-color: #ff0000; background: rgba(255, 0, 0, 0.05); }
        .log-entry.success, .log-entry.mention { border-left-color: #00ff41; background: rgba(0, 255, 65, 0.05); }
        .log-entry.info, .log-entry.operational { border-left-color: #00ffff; }

        .log-timestamp { color: #666; font-size: 0.9em; }
        .log-level { padding: 2px 6px; border-radius: 3px; font-size: 0.85em; margin: 0 5px; }
        .log-level.error { background: rgba(255, 0, 0, 0.2); color: #ff0000; }
        .log-level.warn { background: rgba(255, 165, 0, 0.2); color: #ffa500; }
        .log-level.info { background: rgba(0, 255, 255, 0.2); color: #00ffff; }
        .log-message { margin-top: 5px; color: #7ec8e3; }
        .log-data { margin-top: 5px; padding: 5px; background: rgba(0, 0, 0, 0.3); border-radius: 3px; font-size: 0.9em; color: #888; white-space: pre-wrap; word-break: break-all; max-height: 150px; overflow-y: auto; }

        /* Tool Calls */
        .tool-call { margin-bottom: 15px; padding: 10px; background: rgba(0, 255, 255, 0.02); border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 5px; animation: slideIn 0.3s ease-out; }
        .tool-call.error { background: rgba(255, 0, 0, 0.05); border-color: rgba(255, 0, 0, 0.3); }
        .tool-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .tool-name { color: #00ffff; font-weight: bold; font-size: 1.1em; }
        .tool-status { padding: 3px 8px; border-radius: 3px; font-size: 0.85em; }
        .tool-status.success { background: rgba(0, 255, 65, 0.2); color: #00ff41; }
        .tool-status.error { background: rgba(255, 0, 0, 0.2); color: #ff0000; }
        .tool-args { background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 3px; margin: 8px 0; font-size: 0.9em; color: #888; white-space: pre-wrap; max-height: 200px; overflow-y: auto; }
        .tool-result { background: rgba(0, 255, 65, 0.05); padding: 8px; border-radius: 3px; margin-top: 8px; font-size: 0.9em; color: #00ff41; white-space: pre-wrap; max-height: 200px; overflow-y: auto; }

        /* File Changes */
        .file-change { margin-bottom: 15px; padding: 10px; background: rgba(255, 165, 0, 0.02); border: 1px solid rgba(255, 165, 0, 0.2); border-radius: 5px; animation: slideIn 0.3s ease-out; }
        .file-path { color: #ffa500; font-weight: bold; margin-bottom: 5px; word-break: break-all; }
        .file-action { display: inline-block; padding: 2px 8px; border-radius: 3px; font-size: 0.85em; margin-left: 10px; }
        .file-action.create { background: rgba(0, 255, 65, 0.2); color: #00ff41; }
        .file-action.edit, .file-action.update { background: rgba(0, 255, 255, 0.2); color: #00ffff; }
        .file-action.delete { background: rgba(255, 0, 0, 0.2); color: #ff0000; }
        .file-content-box { background: rgba(0, 0, 0, 0.3); padding: 8px; border-radius: 3px; font-size: 0.85em; max-height: 150px; overflow-y: auto; margin-top: 8px; }

        /* Sessions */
        .session-entry { margin-bottom: 15px; padding: 15px; background: rgba(0, 255, 255, 0.02); border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 5px; animation: slideIn 0.3s ease-out; }
        .session-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .session-id { color: #00ffff; font-weight: bold; font-size: 0.9em; }
        .session-duration { color: #ffa500; font-size: 0.9em; }
        .session-timestamp { color: #666; font-size: 0.85em; margin-bottom: 10px; }
        .session-summary { display: flex; gap: 15px; flex-wrap: wrap; }
        .session-stat { color: #7ec8e3; font-size: 0.85em; }
        .session-status { padding: 2px 8px; border-radius: 3px; font-size: 0.8em; }
        .session-status.normal { background: rgba(0, 255, 65, 0.2); color: #00ff41; }
        .session-status.crash, .session-status.error { background: rgba(255, 0, 0, 0.2); color: #ff0000; }
        .session-status.running { background: rgba(0, 255, 255, 0.2); color: #00ffff; }

        /* Connection Status */
        .connection-status { position: fixed; bottom: 20px; right: 20px; padding: 10px 15px; background: rgba(0, 0, 0, 0.8); border: 1px solid #333; border-radius: 5px; display: flex; align-items: center; gap: 10px; }
        .connection-status.connected { border-color: #00ff41; }
        .connection-status.disconnected { border-color: #ff0000; }
        .connection-dot { width: 10px; height: 10px; border-radius: 50%; }
        .connection-dot.connected { background: #00ff41; animation: pulse 2s infinite; }
        .connection-dot.disconnected { background: #ff0000; }

        /* Error Patterns */
        .error-pattern {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 0, 0, 0.05);
            border: 1px solid rgba(255, 0, 0, 0.2);
            border-left: 4px solid #ff0000;
            border-radius: 5px;
            animation: slideIn 0.3s ease-out;
        }
        .error-header { display: flex; gap: 10px; align-items: flex-start; }
        .error-count {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0000;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: bold;
            white-space: nowrap;
            font-size: 0.9em;
        }
        .error-message { color: #ff6b6b; word-break: break-word; flex: 1; }
        .error-meta { margin-top: 8px; color: #666; font-size: 0.85em; }
        .error-location { color: #ffa500; font-family: monospace; }
        .period-select { background: rgba(0, 0, 0, 0.3); border: 1px solid #00ffff; color: #00ffff; padding: 5px 10px; font-family: inherit; font-size: 0.85em; cursor: pointer; }
        .period-select:focus { outline: none; box-shadow: 0 0 5px rgba(0, 255, 255, 0.3); }
        .empty-state { text-align: center; padding: 40px; color: #666; }
        .empty-state-icon { font-size: 3em; margin-bottom: 10px; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); }
        ::-webkit-scrollbar-thumb { background: rgba(0, 255, 255, 0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0, 255, 255, 0.5); }
    </style>
</head>
<body>
    <div class="header">
        <div class="brand">
            <a href="/" style="color: #00ffff; text-decoration: none; margin-right: 15px; font-size: 1.5em;">&#x1F400;</a>
            <img src="../default.jpg" alt="Bot Sportello" class="logo-thumb" />
            <div class="title">Agent Logging</div>
        </div>
        <div class="status">
            <div class="status-item">
                <span class="status-dot" id="status-dot"></span>
                <span id="status-text">Connecting...</span>
            </div>
            <div class="status-item"><span id="log-count">0</span> Logs</div>
            <div class="status-item"><span id="tool-count">0</span> Tools</div>
            <a href="/src/site-inventory.html" class="nav-link">Site Inventory</a>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" data-panel="logs">System Logs <span class="tab-count" id="logs-count">0</span></button>
        <button class="tab" data-panel="tools">Tool Calls <span class="tab-count" id="tools-count">0</span></button>
        <button class="tab" data-panel="files">File Changes <span class="tab-count" id="files-count">0</span></button>
        <button class="tab" data-panel="errors">Errors <span class="tab-count" id="errors-count">0</span></button>
        <button class="tab" data-panel="sessions">Sessions <span class="tab-count" id="sessions-count">0</span></button>
    </div>

    <div class="main-content">
        <div class="panel active" id="logs-panel">
            <div class="panel-header">
                <div class="panel-title">System Logs</div>
                <div class="panel-actions">
                    <button class="btn" onclick="clearPanel('logs')">Clear</button>
                    <button class="btn" id="autoscroll-btn" onclick="toggleAutoScroll()">Auto-scroll: ON</button>
                </div>
            </div>
            <div class="log-container" id="logs-container"></div>
        </div>

        <div class="panel" id="tools-panel">
            <div class="panel-header">
                <div class="panel-title">Tool Calls</div>
                <div class="panel-actions"><button class="btn" onclick="clearPanel('tools')">Clear</button></div>
            </div>
            <div class="log-container" id="tools-container"></div>
        </div>

        <div class="panel" id="files-panel">
            <div class="panel-header">
                <div class="panel-title">File Changes</div>
                <div class="panel-actions"><button class="btn" onclick="clearPanel('files')">Clear</button></div>
            </div>
            <div class="log-container" id="files-container"></div>
        </div>

        <div class="panel" id="errors-panel">
            <div class="panel-header">
                <div class="panel-title">Error Patterns</div>
                <div class="panel-actions">
                    <select id="error-period" class="period-select" onchange="loadErrorPatterns()">
                        <option value="7">Last 7 days</option>
                        <option value="30">Last 30 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                    <button class="btn" onclick="loadErrorPatterns()">Refresh</button>
                </div>
            </div>
            <div class="log-container" id="errors-container"></div>
        </div>

        <div class="panel" id="sessions-panel">
            <div class="panel-header">
                <div class="panel-title">Session History</div>
                <div class="panel-actions"><button class="btn" onclick="loadSessions()">Refresh</button></div>
            </div>
            <div class="log-container" id="sessions-container"></div>
        </div>
    </div>

    <div class="connection-status disconnected" id="connection-status">
        <div class="connection-dot disconnected" id="connection-dot"></div>
        <span id="connection-text">Disconnected</span>
    </div>

    <script>
        // State
        let autoScroll = true;
        let eventSource = null;
        let reconnectAttempts = 0;
        const MAX_ENTRIES = 500;

        // DOM Elements
        const containers = {
            logs: document.getElementById('logs-container'),
            tools: document.getElementById('tools-container'),
            files: document.getElementById('files-container'),
            errors: document.getElementById('errors-container'),
            sessions: document.getElementById('sessions-container')
        };

        // Tab handling
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => switchPanel(tab.dataset.panel));
        });

        function switchPanel(panel) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`.tab[data-panel="${panel}"]`).classList.add('active');
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.getElementById(`${panel}-panel`).classList.add('active');
        }

        // SSE Connection
        function connect() {
            if (eventSource) eventSource.close();

            eventSource = new EventSource('/api/stream');

            eventSource.addEventListener('connected', () => {
                setConnectionStatus(true);
                reconnectAttempts = 0;
                loadInitialData();
            });

            eventSource.addEventListener('mention', e => addLog(JSON.parse(e.data), 'mention'));
            eventSource.addEventListener('error', e => addLog(JSON.parse(e.data), 'error'));
            eventSource.addEventListener('operational', e => addLog(JSON.parse(e.data), 'operational'));
            eventSource.addEventListener('file_change', e => addFileChange(JSON.parse(e.data)));
            eventSource.addEventListener('tool_call', e => addToolCall(JSON.parse(e.data)));
            eventSource.addEventListener('agent_loop', e => addLog(JSON.parse(e.data), 'agent_loop'));

            eventSource.onerror = () => {
                setConnectionStatus(false);
                eventSource.close();
                // Exponential backoff reconnect
                const delay = Math.min(1000 * Math.pow(2, reconnectAttempts), 30000);
                reconnectAttempts++;
                setTimeout(connect, delay);
            };
        }

        function setConnectionStatus(connected) {
            const status = document.getElementById('connection-status');
            const dot = document.getElementById('connection-dot');
            const text = document.getElementById('connection-text');
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');

            if (connected) {
                status.className = 'connection-status connected';
                dot.className = 'connection-dot connected';
                text.textContent = 'Connected';
                statusDot.style.background = '#00ff41';
                statusText.textContent = 'Live';
            } else {
                status.className = 'connection-status disconnected';
                dot.className = 'connection-dot disconnected';
                text.textContent = 'Reconnecting...';
                statusDot.style.background = '#ff0000';
                statusText.textContent = 'Disconnected';
            }
        }

        // Load initial data via REST
        async function loadInitialData() {
            try {
                const [logs, tools, sessions, errorPatterns] = await Promise.all([
                    fetch('/api/logs?limit=100').then(r => r.json()),
                    fetch('/api/tools?limit=50').then(r => r.json()),
                    fetch('/api/sessions?limit=20').then(r => r.json()),
                    fetch('/api/error-patterns?days=7').then(r => r.json())
                ]);

                // Clear and populate (newest first at top)
                containers.logs.innerHTML = '';
                containers.tools.innerHTML = '';
                containers.files.innerHTML = '';

                logs.forEach(log => addLog(log, log.event_type));
                tools.forEach(tool => addToolCall(tool));

                // Extract file changes from logs
                logs.filter(l => l.event_type === 'file_change').forEach(f => addFileChange(f));

                displaySessions(sessions);
                renderErrorPatterns(errorPatterns);
                updateCounts();
            } catch (error) {
                console.error('Failed to load initial data:', error);
            }
        }

        async function loadSessions() {
            try {
                const sessions = await fetch('/api/sessions?limit=20').then(r => r.json());
                displaySessions(sessions);
            } catch (error) {
                console.error('Failed to load sessions:', error);
            }
        }

        async function loadErrorPatterns() {
            try {
                const days = document.getElementById('error-period').value;
                const patterns = await fetch(`/api/error-patterns?days=${days}`).then(r => r.json());
                renderErrorPatterns(patterns);
            } catch (error) {
                console.error('Failed to load error patterns:', error);
                containers.errors.innerHTML = '<div class="empty-state"><div class="empty-state-icon">⚠️</div>Failed to load error patterns</div>';
            }
        }

        function renderErrorPatterns(patterns) {
            if (!patterns || patterns.length === 0) {
                containers.errors.innerHTML = '<div class="empty-state"><div class="empty-state-icon">✓</div>No errors in this period</div>';
                document.getElementById('errors-count').textContent = '0';
                return;
            }

            containers.errors.innerHTML = patterns.map(p => {
                const lastSeen = p.last_seen ? new Date(p.last_seen).toLocaleString() : 'unknown';
                const location = p.locations && p.locations[0] ? p.locations[0] : 'unknown location';
                const message = p.error_message || 'Unknown error';

                return `
                    <div class="error-pattern">
                        <div class="error-header">
                            <span class="error-count">${p.count}×</span>
                            <span class="error-message">${escapeHtml(message)}</span>
                        </div>
                        <div class="error-meta">
                            Last seen: ${lastSeen} |
                            <span class="error-location">${escapeHtml(location)}</span>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('errors-count').textContent = patterns.length;
        }

        // Add functions
        function addLog(data, type) {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type || 'info'}`;

            const timestamp = new Date(data.timestamp).toLocaleTimeString();
            const payload = data.payload || {};
            const message = payload.message || payload.content || JSON.stringify(payload).slice(0, 200);

            entry.innerHTML = `
                <div>
                    <span class="log-timestamp">${timestamp}</span>
                    <span class="log-level ${type}">${(type || 'info').toUpperCase()}</span>
                </div>
                <div class="log-message">${escapeHtml(message)}</div>
                ${Object.keys(payload).length > 1 ? `<div class="log-data">${JSON.stringify(payload, null, 2)}</div>` : ''}
            `;

            appendWithLimit(containers.logs, entry);
            if (autoScroll) containers.logs.scrollTop = 0;
            updateCounts();
        }

        function addToolCall(data) {
            const entry = document.createElement('div');
            const success = !data.error;
            entry.className = `tool-call ${success ? '' : 'error'}`;

            const timestamp = new Date(data.timestamp).toLocaleTimeString();
            const args = data.arguments || data.payload || {};

            entry.innerHTML = `
                <div class="tool-header">
                    <span class="tool-name">${escapeHtml(data.tool_name || 'unknown')}</span>
                    <span class="tool-status ${success ? 'success' : 'error'}">${success ? 'Success' : 'Error'}</span>
                </div>
                <div class="log-timestamp">${timestamp}</div>
                ${Object.keys(args).length ? `<div class="tool-args">${JSON.stringify(args, null, 2)}</div>` : ''}
                ${data.result ? `<div class="tool-result">${escapeHtml(String(data.result).slice(0, 500))}</div>` : ''}
                ${data.error ? `<div class="tool-result" style="background: rgba(255,0,0,0.1); color: #ff0000;">${escapeHtml(data.error)}</div>` : ''}
            `;

            appendWithLimit(containers.tools, entry);
            updateCounts();
        }

        function addFileChange(data) {
            const entry = document.createElement('div');
            entry.className = 'file-change';

            const timestamp = new Date(data.timestamp).toLocaleTimeString();
            const payload = data.payload || {};
            const action = payload.action || 'unknown';
            const path = payload.path || 'unknown';

            entry.innerHTML = `
                <div>
                    <span class="file-path">${escapeHtml(path)}</span>
                    <span class="file-action ${action}">${action.toUpperCase()}</span>
                </div>
                <div class="log-timestamp">${timestamp}</div>
                ${payload.preview ? `<div class="file-content-box">${escapeHtml(payload.preview)}</div>` : ''}
            `;

            appendWithLimit(containers.files, entry);
            updateCounts();
        }

        function displaySessions(sessions) {
            containers.sessions.innerHTML = '';

            sessions.forEach(session => {
                const entry = document.createElement('div');
                entry.className = 'session-entry';

                const startTime = new Date(session.started_at);
                const endTime = session.ended_at ? new Date(session.ended_at) : null;
                const duration = endTime ? formatDuration(endTime - startTime) : 'running';
                const status = session.exit_reason || (endTime ? 'normal' : 'running');

                entry.innerHTML = `
                    <div class="session-header">
                        <span class="session-id">${session.id.slice(0, 8)}...</span>
                        <span class="session-status ${status}">${status.toUpperCase()}</span>
                    </div>
                    <div class="session-timestamp">${startTime.toLocaleString()} - Duration: ${duration}</div>
                    <div class="session-summary">
                        <span class="session-stat">Events: ${session.event_count || 0}</span>
                        <span class="session-stat">Errors: ${session.error_count || 0}</span>
                        <span class="session-stat">Host: ${session.hostname || 'unknown'}</span>
                        <span class="session-stat">Version: ${session.version || 'unknown'}</span>
                    </div>
                `;

                containers.sessions.appendChild(entry);
            });

            document.getElementById('sessions-count').textContent = sessions.length;
        }

        // Utilities
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }

        function formatDuration(ms) {
            const seconds = Math.floor(ms / 1000);
            if (seconds < 60) return `${seconds}s`;
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ${seconds % 60}s`;
            const hours = Math.floor(minutes / 60);
            return `${hours}h ${minutes % 60}m`;
        }

        function appendWithLimit(container, element) {
            container.prepend(element);
            while (container.children.length > MAX_ENTRIES) {
                container.removeChild(container.lastChild);
            }
        }

        function updateCounts() {
            const logCount = containers.logs.children.length;
            const toolCount = containers.tools.children.length;
            const fileCount = containers.files.children.length;

            document.getElementById('log-count').textContent = logCount;
            document.getElementById('tool-count').textContent = toolCount;
            document.getElementById('logs-count').textContent = logCount;
            document.getElementById('tools-count').textContent = toolCount;
            document.getElementById('files-count').textContent = fileCount;
        }

        function clearPanel(panel) {
            containers[panel].innerHTML = '';
            updateCounts();
        }

        function toggleAutoScroll() {
            autoScroll = !autoScroll;
            document.getElementById('autoscroll-btn').textContent = `Auto-scroll: ${autoScroll ? 'ON' : 'OFF'}`;
        }

        // Initialize
        connect();
    </script>
</body>
</html>
